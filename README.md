
# am-deny-hosts
This application provides a set of shell scripts that helps to protect your Linux server from SSH attacks by applying IP block lists to your hosts.deny file. The solution uses minimum resources on your server.

One of the most annoying consequences of operating a public server on the internet is the amount of SSH attacks it will experience. You simply have to view your /var/log/auth.log to see what we mean. Since your server is publicly available you cannot prevent these attacks. What you can do is block them. 

There are a few methods to block IP addresses from accessing your server. These include [Fail2Ban](https://www.fail2ban.org), [DenyHosts](http://denyhosts.sourceforge.net/), [IPTables](https://en.wikipedia.org/wiki/Iptables), and others. The problem with these solutions is that they may be resource intensive and difficult to setup.

The am-deny-hosts application attempts to provide a simple, reliable, and easy to setup solution that can effectively reduce the risk that your server will be compromised by SSH attacks. This solution is also intended to minimize the resource utilization on your server and allow it to perform its function without wasting CPU cycles analysing your /var/log/auth.log file.  

## System Requirements
The shell scripts delivered with this application should work on any Linux server. They require basic system commands like **sed**, **awk**, **grep**, **cat**, and **wget**. By default, your system should include all of these commands except perhaps **wget** which can be easily installed.

You should have root access to your server to operate the application successfully. You can still test the scripts without root access before requesting an administrator to install it for you. 

The shell scripts were tested on many versions of **Debian** and **Ubuntu**. There is no reason the expect that they will not work successfully with other Linux flavors like **Fedora**, **CentOS**, **RedHart**, **OpenSUSE**, and others. 

## Installation Instructions

1. Download the application scripts to your server.
2. Copy the scripts located in `/usr/local/bin/` to a directory within your PATH environment. we recommend using the `/usr/local/bin/` directory since it is usually in your system PATH by default. 
3. Use the `chmod` command to set the permissions of the scripts to 755. This allows it to be executed by anyone but it will not allowed overwriting of your `/etc/hosts.deny` except by the root user.
4. Optionally, use the `chown` command to set the owner and group of the scripts to `root`. You have to be the root user to accomplish this successfully.
5. Create crontab file or add a line to your existing crontab file with the following or similar contents.

`# Execute am-deny-host at 10 minutes after midnight every day. Redirect stderr and stdout output`

`10 0 * * * /user/local/bin/am-deny-hosts >> /tmp/am-deny-hosts.log 2>&1`

## How am-deny-hosts works
The **am-deny-hosts** script updates your /etc/hosts.deny file using downloaded block lists that contain IP addresses of known SSH attackers. It also includes the IP address of hosts that attack your own server using a block list generated by the **am-list-fails** script. You hosts.deny file can up updated periodically by adding a cron job to run the script.

The **am-list-fails** script captures a list of unique IP address that exceeded a maximum number of authentication attempts with your server. The default maximum number of attempts is set to 10. This should prevent including legitimate users who might have forgotten their password or used an unrecognized public key.

The **am-latest-fails** script generates the IP addresses of the most recent attackers. It does the same job as the **am-list-fails** by capturing data the most recent auth.log file.

The **am-list-logins** script lists the hosts that were recently successful authenticating with your server. You can use this report to do a paranoia check that would help to verify that a successful attack did not occur.

The **am-login-ips** script generates a uniques list of IP addresses that recently authenticated successfully with your server. Use can add this list to your **hosts.allow** file but it is not typically necessary.

The **am-list-refused** script generates a uniques list of IP addresses of hosts that were refused a connection to your server. The report lets you analyse the success rate for blocking SSH attackers. Typically an attacker will cease and desist when they are refused a connection. 

